#############################################################################################
###   NAME:              itmticketautomation.yml                                             #
###   VERSION:           1.0                                                                 #
###   DESCRIPTION:       Automate the ticket on Service Now: ITM start process               #
###   CREATION DATE:     20/11/2019                                                          #
###   ESCRITO POR:       Felipe Thomaz Giffu                                                 #
###   E-MAIL:            felipe.giffu@ibm.com                                                #
###   PLATFORM:          Red Hat / SUSE                                                      #
#############################################################################################
---
- name: itmticketautomation
  hosts: massive.boulder.ibm.com
  remote_user: ansible
  become: yes
  become_method: sudo

  tasks:
    - name: Validating ITM klzagent process
      shell: ps -ef |grep klzagent | grep -v grep
      register: ps_output       
      ignore_errors: yes
    - name: Execute Script - ITM Start
      shell:
        cmd: /opt/IBM/ITM/bin/itmcmd agent start lz
      when: 
      - ps_output.stat.exists == false
#      - ansible_distribution == "SLES"
      ignore_errors: no
    - name: Execute Script - ITM Status
      shell:
        cmd: /opt/IBM/ITM/bin/cinfo -r
      register: infoscript
    - name: Display ITM Status
      debug:
        var: infoscript

       
...
