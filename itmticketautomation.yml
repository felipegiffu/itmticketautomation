---
- name: itmticketautomation
  hosts: massive.boulder.ibm.com
  remote_user: ansible
  become: yes
  become_method: sudo

  tasks:
    - name: Comparing last kernel and running kernel
      shell: |
        ps_output=$(ps -ef |grep klzagent | grep -v grep)
        if [[ $ps_output == NULL ]]; then
        # Stop playbook
        echo "1"
        fi
      register: ps_results
    - debug: ps_results.stdout_lines
    - name: Execute Script - ITM Start
      shell:
        cmd: /opt/IBM/ITM/bin/itmcmd agent start lz
      when:
      - ps_output.stat.exists == true
      - ansible_distribution == "SLES"
      ignore_errors: no
    - name: Execute Script - ITM Status
      shell:
        cmd: /opt/IBM/ITM/bin/cinfo -r
      register: infoscript
    - name: Display ITM Status
      debug:
        var: infoscript


...
